/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@uwdata/mosaic-inputs@0.10.0/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{coordinator as t,MosaicClient as e,isSelection as s,clausePoint as i,isParam as n,clauseMatch as l,clauseInterval as r,clausePoints as h,toDataColumns as o}from"../mosaic-core@0.10.0/_esm.js";import{Query as a,min as c,max as u,column as d,desc as m}from"../mosaic-sql@0.10.0/_esm.js";import{format as p}from"../../isoformat@0.2.1/_esm.js";function f(e,s){const i=new e(s);return t().connect(i),i.element}const b=t=>f(v,t);class v extends e{constructor({element:t,filterBy:e,from:i,column:n,label:l=n,format:r=(t=>t),options:h,value:o,field:a=n,as:c}={}){super(e),this.from=i,this.column=n,this.format=r,this.field=a;const u=this.selection=c;this.element=t??document.createElement("div"),this.element.setAttribute("class","input"),Object.defineProperty(this.element,"value",{value:this});const d=document.createElement("label");if(d.innerText=l||n,this.element.appendChild(d),this.select=document.createElement("select"),this.element.appendChild(this.select),h&&(this.data=h.map((t=>{return(e=t)&&"object"==typeof e&&!Array.isArray(e)?t:{value:t};var e})),this.selectedValue(o??""),this.update()),u){const t=!s(u);null==o||t&&void 0!==u.value||this.publish(o),this.select.addEventListener("input",(()=>{this.publish(this.selectedValue()??null)})),t&&this.selection.addEventListener("value",(t=>{t!==this.select.value&&this.selectedValue(t)}))}}selectedValue(t){if(0===arguments.length){const t=this.select.selectedIndex;return this.data[t].value}{const e=this.data?.findIndex((e=>e.value===t));e>=0?this.select.selectedIndex=e:this.select.value=String(t)}}reset(){this.select.selectedIndex=this.from?0:-1}publish(t){const{selection:e,field:l}=this;if(s(e)){""===t&&(t=void 0);const s=i(l,t,{source:this});e.update(s)}else n(e)&&e.update(t)}query(t=[]){const{from:e,column:s}=this;return e?a.from(e).select({value:s}).distinct().where(t).orderby(s):null}queryResult(t){return this.data=[{value:"",label:"All"},...t],this}update(){const{data:t,format:e,select:i,selection:n}=this;i.replaceChildren();for(const{value:s,label:i}of t){const t=document.createElement("option");t.setAttribute("value",s),t.innerText=i??e(s),this.select.appendChild(t)}if(n){const t=s(n)?n.valueFor(this):n.value;this.selectedValue(t??"")}return this}}let y=0;const x=t=>f(E,t);class E extends e{constructor({element:t,filterBy:e,from:i,column:n,label:l,type:r="contains",field:h=n,as:o}={}){if(super(e),this.id="search_"+ ++y,this.type=r,this.from=i,this.column=n,this.selection=o,this.field=h,this.element=t??document.createElement("div"),this.element.setAttribute("class","input"),Object.defineProperty(this.element,"value",{value:this}),l){const t=document.createElement("label");t.setAttribute("for",this.id),t.innerText=l,this.element.appendChild(t)}this.searchbox=document.createElement("input"),this.searchbox.setAttribute("id",this.id),this.searchbox.setAttribute("type","text"),this.searchbox.setAttribute("placeholder","Query"),this.element.appendChild(this.searchbox),this.selection&&(this.searchbox.addEventListener("input",(()=>{this.publish(this.searchbox.value||null)})),s(this.selection)||this.selection.addEventListener("value",(t=>{t!==this.searchbox.value&&(this.searchbox.value=t)})))}reset(){this.searchbox.value=""}publish(t){const{selection:e,field:i,type:r}=this;if(s(e)){const s=l(i,t,{source:this,method:r});e.update(s)}else n(e)&&e.update(t)}query(t=[]){const{from:e,column:s}=this;return e?a.from(e).select({list:s}).distinct().where(t):null}queryResult(t){return this.data=t,this}update(){const t=document.createElement("datalist"),e=`${this.id}_list`;t.setAttribute("id",e);for(const e of this.data){const s=document.createElement("option");s.setAttribute("value",e.list),t.append(s)}return this.datalist&&this.datalist.remove(),this.element.appendChild(this.datalist=t),this.searchbox.setAttribute("list",e),this}}let C=0;const A=t=>f(w,t);class w extends e{constructor({element:t,filterBy:e,as:i,min:n,max:l,step:r,from:h,column:o,label:a=o,value:c=i?.value,select:u="point",field:d=o,width:m}={}){if(super(e),this.id="slider_"+ ++C,this.from=h,this.column=o||"value",this.selection=i,this.selectionType=u,this.field=d,this.min=n,this.max=l,this.step=r,this.element=t||document.createElement("div"),this.element.setAttribute("class","input"),Object.defineProperty(this.element,"value",{value:this}),a){const t=document.createElement("label");t.setAttribute("for",this.id),t.innerText=a,this.element.appendChild(t)}this.slider=document.createElement("input"),this.slider.setAttribute("id",this.id),this.slider.setAttribute("type","range"),null!=m&&(this.slider.style.width=+m+"px"),null!=n&&this.slider.setAttribute("min",`${n}`),null!=l&&this.slider.setAttribute("max",`${l}`),null!=r&&this.slider.setAttribute("step",`${r}`),this.element.appendChild(this.slider),this.curval=document.createElement("label"),this.curval.setAttribute("for",this.id),this.curval.setAttribute("class","value"),this.element.appendChild(this.curval),null!=c&&(this.slider.setAttribute("value",`${c}`),void 0===this.selection?.value&&this.publish(c)),this.curval.innerText=this.slider.value,this.slider.addEventListener("input",(()=>{const{value:t}=this.slider;this.curval.innerText=t,this.selection&&this.publish(+t)})),this.selection&&!s(this.selection)&&this.selection.addEventListener("value",(t=>{t!==+this.slider.value&&(this.slider.value=t,this.curval.innerText=t)}))}query(t=[]){const{from:e,column:s}=this;return!e||null!=this.min&&null!=this.max?null:a.select({min:c(s),max:u(s)}).from(e).where(t)}queryResult(t){const{min:e,max:s}=Array.from(t)[0];return null==this.min&&(this.min=e,this.slider.setAttribute("min",`${e}`)),null==this.max&&(this.max=s,this.slider.setAttribute("max",`${s}`)),null==this.step&&(this.step=(s-e)/500,this.slider.setAttribute("step",`${this.step}`)),this}publish(t){const{field:e,selectionType:l,selection:h}=this;if(s(h))if("interval"===l){const s=[this.min??0,t];h.update(r(e,s,{source:this,bin:"ceil",scale:{type:"identity",domain:s},pixelSize:this.step}))}else h.update(i(e,t,{source:this}));else n(this.selection)&&h.update(t)}}const g=_((t=>{const e=$(t);return t=>null==t?"":"number"==typeof t?e(t):t instanceof Date?T(t):`${t}`})),$=_((t=>e=>0===e?"0":e.toLocaleString(t)));function T(t){return p(t,"Invalid Date")}function _(t){let e,s=null;return(i="en")=>i===s?e:e=t(s=i)}g(),$();let q=-1;const L=t=>f(D,t);class D extends e{constructor({element:t,filterBy:e,from:s,columns:i=["*"],align:n={},format:l,width:r,maxWidth:h,height:o=500,rowBatch:a=100,as:c}={}){super(e),this.id="table-"+ ++q,this.from=s,this.columns=i,this.format=l,this.align=n,this.widths="object"==typeof r?r:{},this.offset=0,this.limit=+a,this.pending=!1,this.selection=c,this.currentRow=-1,this.sortHeader=null,this.sortColumn=null,this.sortDesc=!1,this.element=t||document.createElement("div"),this.element.setAttribute("id",this.id),Object.defineProperty(this.element,"value",{value:this}),"number"==typeof r&&(this.element.style.width=`${r}px`),h&&(this.element.style.maxWidth=`${h}px`),this.element.style.maxHeight=`${o}px`,this.element.style.overflow="auto";let u=-1;this.element.addEventListener("scroll",(t=>{const{pending:e,loaded:s}=this,{scrollHeight:i,scrollTop:n,clientHeight:l}=t.target,r=n<u;u=n,r||e||s||i-n<2*l&&(this.pending=!0,this.requestData(this.offset+this.limit))})),this.tbl=document.createElement("table"),this.element.appendChild(this.tbl),this.head=document.createElement("thead"),this.tbl.appendChild(this.head),this.body=document.createElement("tbody"),this.tbl.appendChild(this.body),this.selection&&(this.body.addEventListener("pointerover",(t=>{const e=function(t){const e=t.parentElement;return Object.hasOwn(e,"__row__")?+e.__row__:-1}(t.target);e>-1&&e!==this.currentRow&&(this.currentRow=e,this.selection.update(this.clause([e])))})),this.body.addEventListener("pointerleave",(()=>{this.currentRow=-1,this.selection.update(this.clause())}))),this.style=document.createElement("style"),this.element.appendChild(this.style)}clause(t=[]){const{data:e,limit:s,schema:i}=this,n=i.map((t=>t.column)),l=t.map((t=>{const{columns:i}=e[~~(t/s)];return n.map((e=>i[e][t%s]))}));return h(n,l,{source:this})}requestData(e=0){this.offset=e;const s=this.query(this.filterBy?.predicate(this));this.requestQuery(s),t().prefetch(s.clone().offset(e+this.limit))}fields(){return this.columns.map((t=>d(this.from,t)))}fieldInfo(t){this.schema=t;const e=this.head;e.innerHTML="";const s=document.createElement("tr");for(const{column:e}of t){const t=document.createElement("th");t.addEventListener("click",(t=>this.sort(t,e))),t.appendChild(document.createElement("span")),t.appendChild(document.createTextNode(e)),s.appendChild(t)}return e.appendChild(s),this.formats=function(t={},e,s){return e.map((({column:e,type:i})=>{if(e in t)return t[e];switch(i){case"number":return $(s);case"date":return T;default:return g(s)}}))}(this.format,t),this.style.innerText=function(t,e,s){const i=[];return e.forEach(((e,n)=>{const l=+s[n];if("left"!==e||l){const s="left"!==e?`text-align:${e};`:"",r=l?`width:${l}px;max-width:${l}px;`:"";i.push(`#${t} tr>:nth-child(${n+1}) {${s}${r}}`)}})),i.join(" ")}(this.id,function(t={},e){return e.map((({column:e,type:s})=>e in t?t[e]:"number"===s?"right":"left"))}(this.align,t),function(t={},e){return e.map((({column:e})=>t[e]))}(this.widths,t)),this}query(t=[]){const{from:e,limit:s,offset:i,schema:n,sortColumn:l,sortDesc:r}=this;return a.from(e).select(n.map((t=>t.column))).where(t).orderby(l?r?m(l):l:[]).limit(s).offset(i)}queryResult(t){return this.pending||(this.loaded=!1,this.data=[],this.body.replaceChildren(),this.offset=0),this.data.push(o(t)),this}update(){const{body:t,formats:e,data:s,schema:i,limit:n}=this,l=i.length,r=s.length-1,h=n*r,{numRows:o,columns:a}=s[r],c=i.map((t=>a[t.column]));for(let s=0;s<o;++s){const i=document.createElement("tr");Object.assign(i,{__row__:h+s});for(let t=0;t<l;++t){const n=c[t][s],l=document.createElement("td");l.innerText=null==n?"":e[t](n),i.appendChild(l)}t.appendChild(i)}return o<n&&(this.loaded=!0),this.pending=!1,this}sort(t,e){e===this.sortColumn?this.sortDesc=!this.sortDesc:(this.sortColumn=e,this.sortDesc=!1);const s=t.currentTarget,i=this.sortHeader;i===s&&t.metaKey?(i.firstChild.textContent="",this.sortHeader=null,this.sortColumn=null):(i&&(i.firstChild.textContent=""),this.sortHeader=s,s.firstChild.textContent=this.sortDesc?"▾":"▴"),this.requestData()}}export{v as Menu,E as Search,w as Slider,D as Table,b as menu,x as search,A as slider,L as table};export default null;
